<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@WebFXProject"><meta name="twitter:creator" content="@WebFXProject"><meta name="twitter:title" content="Opening files"><meta name="twitter:description" content="How to open local files with WebFX"><meta name="twitter:image" content="https://blog.webfx.dev/opening-files/opening-files.htmlFilesDemo.png"><title> Opening files · The WebFX blog</title><meta name="description" content="Opening files - Bruno Salmon"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../favicon.png"><link rel="stylesheet" href="../css/hermes.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.webfx.dev/atom.xml" title="The WebFX blog"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="The WebFX blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="../index.html"><img src="../WebFX.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="../index.html" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="../archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/webfx-project/webfx" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="../atom.xml" target="_self">FEED</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Opening files</h1><div class="post-info">Oct 18, 2022</div><div class="post-content"><p>First of all, a big thank you to the JavaFX community for warmly welcoming us on Twitter. In just a couple of days after creating our account, you were already 100+ to follow us! And <a target="_blank" rel="noopener" href="https://www.jfx-central.com/">JFX-Central</a> kindly listed us in their <em>Links of the Week</em> on September 30, linking our last blog and demo. Thank you all for your interest in WebFX! ❤️</p>
<p>Thank you for your questions as well. The most frequent question was about accessing local files. This feature was not implemented at that time, but we investigated, and we are glad to announce that now WebFX can access local files, as demonstrated with our brand-new <a target="_blank" rel="noopener" href="https://files.webfx.dev/">Files demo</a>.</p>
<p>This demo lets you select local files with either the <em>Choose files</em> button or drag &amp; drop. The files are listed with their icon and other simple details, and a thumbnail is displayed for images. A grid view is also available with just the thumbnails. You can open your images in full size, and navigate using left &amp; right keys or mouse clicks or swipes on touch screens. Same with your audio files, which are played together with the equaliser from our DemoFX library. Video files will be played very soon (only the audio is played for now). Text files can be displayed in a TextArea.</p>
<p><strong>Issues with the JavaFX FileChooser and Java File API</strong></p>
<p>Our first investigation was rather bad news: it appeared that it was impossible to emulate the JavaFX FileChooser API in the browser, mainly for the 2 following reasons:</p>
<ul>
<li><p>In JavaFX, opening the file chooser is done programmatically through a call to FileChooser.showOpenDialog(), which in addition is a blocking call - something prohibited in JavaScript - while in the browser it is done through a user interaction with the HTML input element <code>&lt;input type=&quot;file&quot;&gt;</code> which is rendered by default like this: <input type="file">   </p>
</li>
<li><p>The <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/File">File</a> object returned by the browser file chooser (rather called FilePicker) has very limited information about the actual local file. For example, it doesn’t let you know its location on the local machine, and its URL is a kind of random UUID that is valid only for the time of the session. With such a limited sandbox object, it’s impossible to emulate java.io.File, the object returned by the JavaFX FileChooser.</p>
</li>
</ul>
<p><strong>The alternative cross-platform API offered by WebFX</strong></p>
<p>While it’s impossible to emulate the JavaFX FileChooser and the Java File API in the browser, the opposite is possible: it’s quite simple to emulate the Web FilePicker and Web File API in Java&#x2F;JavaFX. This is therefore the WebFX approach.</p>
<p>In our <a target="_blank" rel="noopener" href="https://github.com/webfx-project/webfx-platform">WebFX Platform</a>, you will see the following new modules:</p>
<ol>
<li><code>webfx-platform-file</code> : WebFX cross-platform File API</li>
<li><code>webfx-platform-file-java</code> : its implementation in Java (wrapping Java File)</li>
<li><code>webfx-platform-file-gwt</code> : its implementation in GWT (wrapping Web File)</li>
</ol>
<p>And in our <a target="_blank" rel="noopener" href="https://github.com/webfx-project/webfx-extras">WebFX Extras</a> library, the following new modules:</p>
<ol>
<li><code>webfx-extras-filepicker</code> : WebFX cross-platform FilePicker API</li>
<li><code>webfx-extras-filepicker-openjfx</code> : its implementation in OpenJFX (wrapping the JavaFX FileChooser)</li>
<li><code>webfx-extras-filepicker-gwt</code> : its implementation in GWT (wrapping Web FilePicker)</li>
</ol>
<p><strong>Show me the code</strong></p>
<p>Here is the Files demo main <a target="_blank" rel="noopener" href="https://github.com/webfx-demos/webfx-demo-files/blob/main/webfx-demo-files-application/src/main/java/dev/webfx/demo/files/FilesApplication.java">Java file</a>.</p>
<p>So your Java code will typically look like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating an instance of FilePicker</span></span><br><span class="line"><span class="type">FilePicker</span> <span class="variable">filePicker</span> <span class="operator">=</span> FilePicker.create();</span><br><span class="line"><span class="comment">// Customizing the FilePicker button appearance</span></span><br><span class="line">filePicker.setGraphic(myBeautifulJavaFXNode); </span><br><span class="line"><span class="comment">// Allowing multiple file selection</span></span><br><span class="line">filePicker.setMultiple(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// Inserting the FilePicker button in the UI</span></span><br><span class="line">myBorderPane.setTop(filePicker.getView()); <span class="comment">// The GWT implementation of getView() will hide the ugly HTML default button, and display your node instead </span></span><br><span class="line"><span class="comment">// Reacting to the user files selection</span></span><br><span class="line">filePicker.getSelectedFiles().addListener(...)</span><br></pre></td></tr></table></figure>

<p>As you can see, there is no programmatic call to open the FilePicker. You get your files by listening <code>getSelectedFiles()</code> which returns an <code>ObservableList&lt;File&gt;</code> (or <code>getSelectedFile()</code> which returns <code>ReadOnlyObjectProperty&lt;File&gt;</code> in case of single file selection).</p>
<p>For the drag &amp; drop support, your code will typically look like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// When the user drag files over that node, we tell the system we are accepting them</span></span><br><span class="line">myDragAndDropZoneNode.setOnDragOver(e -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.getDragboard().hasContent(DataFormat.FILES)) &#123;</span><br><span class="line">        e.acceptTransferModes(TransferMode.COPY);</span><br><span class="line">        ... <span class="comment">// Good to do a visual change here such as changing the border of the node</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// When the user finally drop the files on that node, we get them</span></span><br><span class="line">myDragAndDropZoneNode.setOnDragDropped(e -&gt; &#123;</span><br><span class="line">    <span class="type">Dragboard</span> <span class="variable">db</span> <span class="operator">=</span> e.getDragboard();</span><br><span class="line">    <span class="keyword">if</span> (db.hasContent(DataFormat.FILES)) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">platformFiles</span> <span class="operator">=</span> db.getContent(DataFormat.FILES);</span><br><span class="line">        List&lt;File&gt; fileList = File.createFileList(platformFiles);</span><br><span class="line">        ... <span class="comment">// Your logic about what to do with these files </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>The object returned by <code>db.getContent(DataFormat.FILES)</code> is a native list of the files from the underlying platform, but you can transform it into a cross-platform list of files by calling <code>File.createFileList()</code>.</p>
<p>Example of what you can do with WebFX File objects:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Getting the file name (doesn&#x27;t include the folder path)</span></span><br><span class="line"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getName();</span><br><span class="line"><span class="comment">// Getting the file length in bytes</span></span><br><span class="line"><span class="type">long</span> <span class="variable">fileLength</span> <span class="operator">=</span> file.length();</span><br><span class="line"><span class="comment">// Getting the last modified date &amp; time in Epoch milliseconds</span></span><br><span class="line"><span class="type">long</span> <span class="variable">fileLastModified</span> <span class="operator">=</span> file.lastModified();</span><br><span class="line"><span class="comment">// Getting the MIME type of the file</span></span><br><span class="line"><span class="type">String</span> <span class="variable">mimeType</span> <span class="operator">=</span> file.getMimeType();</span><br><span class="line"><span class="comment">// Getting an object URL that can be used to reference the contents of the file</span></span><br><span class="line"><span class="type">String</span> <span class="variable">objectURL</span> <span class="operator">=</span> file.getObjectURL();</span><br></pre></td></tr></table></figure>

<p>The GWT implementation of <code>File.getObjectURL()</code> calls the Web API <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL">URL.createObjectURL()</a> which can be used to open the file, for example (this works also on the Java&#x2F;JavaFX platform):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*===== IMAGE FILES (ie MIME type starting with &quot;image/&quot;) =====*/</span></span><br><span class="line"><span class="type">ImageView</span> <span class="variable">imageView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageView</span>(file.getObjectURL());</span><br><span class="line"><span class="comment">// Alternatively</span></span><br><span class="line"><span class="type">ImageView</span> <span class="variable">imageView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageView</span>(<span class="keyword">new</span> <span class="title class_">Image</span>(file.getURLPath(), <span class="literal">true</span>)); <span class="comment">// true for background loading</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*===== AUDIO &amp; VIDEO FILES (ie MIME type starting with &quot;audio/&quot; or &quot;video/&quot;) =====*/</span></span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>(<span class="keyword">new</span> <span class="title class_">Media</span>(file.getObjectURL()));</span><br><span class="line">mediaPlayer.play();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*===== TEXT FILES (ie MIME type starting with &quot;text/&quot;) =====*/</span></span><br><span class="line"><span class="type">TextArea</span> <span class="variable">textArea</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextArea</span>();</span><br><span class="line">FileReader.create()   <span class="comment">// FileReader is also part of the WebFX File API</span></span><br><span class="line">    .readAsText(file) <span class="comment">// Asynchronous call </span></span><br><span class="line">    .onSuccess(textArea::setText); <span class="comment">// Successful callback</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>What’s next?</strong></p>
</div></article></div></main><footer><div class="paginator"></div><div class="copyright"><p><a href="https://webfx.dev" target="_blank">WebFX</a> © 2021 - 2022</p></div></footer></div><!--script(async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous")--></body></html>